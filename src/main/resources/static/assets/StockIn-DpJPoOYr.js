import{s as p}from"./request-BRaJE9vJ.js";import{_ as H,r as u,o as J,b as V,e as t,f as o,g as r,A as f,q as K,j as m,k as I,x as Q,m as i,p as D,l as x,F as E,y as S,E as W}from"./index-C_fYYLRm.js";const X={class:"stockin-view"},Y={class:"table-header"},Z={class:"dialog-footer"},ee={__name:"StockIn",setup(le){const _=u(!1),C=u([]),g=u([]),b=u([]),d=u(!1),s=u({}),y=u(null),v=u(!1),h=u([]),w=async()=>{_.value=!0;try{const[a,e,n]=await Promise.all([p.get("/stockin"),p.get("/fruits"),p.get("/suppliers")]);C.value=a||[],g.value=e||[],b.value=n||[],h.value=C.value}catch(a){console.error(a),f.error("获取数据失败")}finally{_.value=!1}},N=a=>{const e=g.value.find(n=>n.id===a);return e?e.name:a},R=a=>{const e=b.value.find(n=>n.id===a);return e?e.name:a},F=a=>a?new Date(a).toLocaleString():"",U=()=>{v.value=!1,s.value={stockInDate:new Date().toISOString()},d.value=!0},$=a=>{v.value=!0,s.value={...a},d.value=!0},M=a=>{W.confirm("确定要删除这条进货记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await p.delete(`/stockin/${a.id}`),f.success("删除成功"),w()}catch(e){console.error(e),f.error("删除失败")}})},T=async()=>{y.value&&await y.value.validate(async a=>{if(a)try{v.value?(await p.put("/stockin",s.value),f.success("修改成功")):(await p.post("/stockin",s.value),f.success("进货成功")),d.value=!1,w()}catch(e){console.error(e),f.error(v.value?"修改失败":"进货失败")}})};return J(()=>{w()}),(a,e)=>{const n=r("el-button"),c=r("el-table-column"),z=r("el-table"),A=r("el-card"),q=r("el-option"),B=r("el-select"),k=r("el-form-item"),L=r("el-input-number"),P=r("el-form"),j=r("el-dialog"),O=K("loading");return m(),V("div",X,[t(A,{shadow:"never",class:"glass-panel"},{default:o(()=>[I("div",Y,[e[6]||(e[6]=I("h3",null,"进货记录",-1)),t(n,{type:"primary",icon:"Plus",onClick:U},{default:o(()=>[...e[5]||(e[5]=[i("新增进货",-1)])]),_:1})]),Q((m(),D(z,{data:h.value,style:{width:"100%"},class:"custom-table"},{default:o(()=>[t(c,{prop:"id",label:"ID",width:"80"}),t(c,{label:"水果"},{default:o(l=>[i(x(N(l.row.fruitId)),1)]),_:1}),t(c,{prop:"quantity",label:"数量"}),t(c,{label:"供应商"},{default:o(l=>[i(x(R(l.row.supplierId)),1)]),_:1}),t(c,{label:"日期"},{default:o(l=>[i(x(F(l.row.stockInDate)),1)]),_:1}),t(c,{label:"操作",width:"180",align:"right"},{default:o(l=>[t(n,{size:"small",onClick:G=>$(l.row)},{default:o(()=>[...e[7]||(e[7]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(n,{size:"small",type:"danger",onClick:G=>M(l.row)},{default:o(()=>[...e[8]||(e[8]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,_.value]])]),_:1}),t(j,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=l=>d.value=l),title:v.value?"编辑进货":"新增进货",width:"500px"},{footer:o(()=>[I("span",Z,[t(n,{onClick:e[3]||(e[3]=l=>d.value=!1)},{default:o(()=>[...e[9]||(e[9]=[i("取消",-1)])]),_:1}),t(n,{type:"primary",onClick:T},{default:o(()=>[...e[10]||(e[10]=[i("确定",-1)])]),_:1})])]),default:o(()=>[t(P,{ref_key:"formRef",ref:y,model:s.value,"label-width":"80px"},{default:o(()=>[t(k,{label:"水果",prop:"fruitId",rules:[{required:!0,message:"请选择水果",trigger:"change"}]},{default:o(()=>[t(B,{modelValue:s.value.fruitId,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.fruitId=l),placeholder:"请选择水果",style:{width:"100%"}},{default:o(()=>[(m(!0),V(E,null,S(g.value,l=>(m(),D(q,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"数量",prop:"quantity",rules:[{required:!0,message:"请输入数量",trigger:"blur"}]},{default:o(()=>[t(L,{modelValue:s.value.quantity,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.quantity=l),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(k,{label:"供应商",prop:"supplierId",rules:[{required:!0,message:"请选择供应商",trigger:"change"}]},{default:o(()=>[t(B,{modelValue:s.value.supplierId,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.supplierId=l),placeholder:"请选择供应商",style:{width:"100%"}},{default:o(()=>[(m(!0),V(E,null,S(b.value,l=>(m(),D(q,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},oe=H(ee,[["__scopeId","data-v-aba9a9a3"]]);export{oe as default};
