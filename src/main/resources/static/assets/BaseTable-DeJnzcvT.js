import{s as w}from"./request-D9c0grRd.js";import{_ as W,r as i,c as h,w as X,b as v,e as s,f as a,g as p,q as Y,j as o,k as B,x as Z,m as c,p as b,F as E,y as I,l as C,z as ee,E as le,A as U}from"./index-DlRqpuOy.js";const te={class:"base-table"},ae={class:"table-header"},oe={key:0,style:{color:"#67C23A","font-weight":"bold"}},re={key:2},se={class:"dialog-footer"},pe={__name:"BaseTable",props:{type:{type:String,required:!0}},setup(q){const u=q,k=i(!1),V=i([]),d=i(""),m=i(!1),n=i({}),x=i(null),y=i(!1),D={fruits:{columns:[{prop:"id",label:"ID",width:80},{prop:"name",label:"名称"},{prop:"price",label:"单价",type:"price"},{prop:"unit",label:"单位"},{prop:"stock",label:"库存",type:"stock"}],fields:[{prop:"name",label:"名称"},{prop:"price",label:"单价",rules:[{required:!0,message:"请输入单价",trigger:"blur"},{pattern:/^\d+$/,message:"单价必须为整数",trigger:"blur"}]},{prop:"unit",label:"单位"},{prop:"stock",label:"库存",type:"number"}]},employees:{columns:[{prop:"id",label:"ID",width:80},{prop:"name",label:"姓名"},{prop:"phone",label:"电话"},{prop:"position",label:"职位"}],fields:[{prop:"name",label:"姓名"},{prop:"phone",label:"电话"},{prop:"position",label:"职位"}]},customers:{columns:[{prop:"id",label:"ID",width:80},{prop:"name",label:"姓名"},{prop:"phone",label:"电话"},{prop:"address",label:"地址"}],fields:[{prop:"name",label:"姓名"},{prop:"phone",label:"电话"},{prop:"address",label:"地址"}]},suppliers:{columns:[{prop:"id",label:"ID",width:80},{prop:"name",label:"名称"},{prop:"phone",label:"电话"},{prop:"address",label:"地址"}],fields:[{prop:"name",label:"名称"},{prop:"phone",label:"电话"},{prop:"address",label:"地址"}]}},S=h(()=>{var t;return((t=D[u.type])==null?void 0:t.columns)||[]}),F=h(()=>{var t;return((t=D[u.type])==null?void 0:t.fields)||[]}),N=h(()=>y.value?"编辑":"新增"),T=h(()=>{if(!d.value)return V.value;const t=d.value.toLowerCase();return V.value.filter(l=>Object.values(l).some(g=>String(g).toLowerCase().includes(t)))}),f=async()=>{k.value=!0;try{V.value=await w.get(`/${u.type}`)}finally{k.value=!1}},z=async()=>{if(!d.value){f();return}},A=()=>{y.value=!1,n.value={},m.value=!0},L=t=>{y.value=!0,n.value={...t},m.value=!0},j=t=>{le.confirm("确认删除该记录吗?","提示",{type:"warning"}).then(async()=>{await w.delete(`/${u.type}/${t.id}`),U.success("删除成功"),f()})},M=async()=>{x.value&&await x.value.validate(async t=>{if(t)try{y.value?await w.post(`/${u.type}`,n.value):await w.post(`/${u.type}`,n.value),U.success("保存成功"),m.value=!1,f()}catch{}})};return X(()=>u.type,()=>{d.value="",f()},{immediate:!0}),(t,l)=>{const g=p("el-input"),_=p("el-button"),R=p("el-tag"),$=p("el-table-column"),O=p("el-table"),P=p("el-card"),Q=p("el-input-number"),G=p("el-form-item"),H=p("el-form"),J=p("el-dialog"),K=Y("loading");return o(),v("div",te,[s(P,{shadow:"never"},{default:a(()=>[B("div",ae,[s(g,{modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=e=>d.value=e),placeholder:"搜索...","prefix-icon":"Search",style:{width:"300px"},clearable:"",onInput:z},null,8,["modelValue"]),s(_,{type:"primary",icon:"Plus",onClick:A},{default:a(()=>[...l[3]||(l[3]=[c("新增记录",-1)])]),_:1})]),Z((o(),b(O,{data:T.value,style:{width:"100%","margin-top":"20px"},stripe:""},{default:a(()=>[(o(!0),v(E,null,I(S.value,e=>(o(),b($,{key:e.prop,prop:e.prop,label:e.label,width:e.width},{default:a(r=>[e.type==="price"?(o(),v("span",oe," ¥"+C(r.row[e.prop]),1)):e.type==="stock"?(o(),b(R,{key:1,type:r.row[e.prop]<10?"danger":"success"},{default:a(()=>[c(C(r.row[e.prop]),1)]),_:2},1032,["type"])):(o(),v("span",re,C(r.row[e.prop]),1))]),_:2},1032,["prop","label","width"]))),128)),s($,{label:"操作",width:"180",align:"right"},{default:a(e=>[s(_,{size:"small",onClick:r=>L(e.row)},{default:a(()=>[...l[4]||(l[4]=[c("编辑",-1)])]),_:1},8,["onClick"]),s(_,{size:"small",type:"danger",onClick:r=>j(e.row)},{default:a(()=>[...l[5]||(l[5]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[K,k.value]])]),_:1}),s(J,{modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=e=>m.value=e),title:N.value,width:"500px","destroy-on-close":""},{footer:a(()=>[B("span",se,[s(_,{onClick:l[1]||(l[1]=e=>m.value=!1)},{default:a(()=>[...l[6]||(l[6]=[c("取消",-1)])]),_:1}),s(_,{type:"primary",onClick:M},{default:a(()=>[...l[7]||(l[7]=[c("确定",-1)])]),_:1})])]),default:a(()=>[s(H,{ref_key:"formRef",ref:x,model:n.value,"label-width":"80px"},{default:a(()=>[(o(!0),v(E,null,I(F.value,e=>(o(),b(G,{key:e.prop,label:e.label,prop:e.prop,rules:e.rules||[{required:!0,message:"请输入"+e.label,trigger:"blur"}]},{default:a(()=>[!e.type||e.type==="text"?(o(),b(g,{key:0,modelValue:n.value[e.prop],"onUpdate:modelValue":r=>n.value[e.prop]=r},null,8,["modelValue","onUpdate:modelValue"])):e.type==="number"?(o(),b(Q,{key:1,modelValue:n.value[e.prop],"onUpdate:modelValue":r=>n.value[e.prop]=r,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])):ee("",!0)]),_:2},1032,["label","prop","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ie=W(pe,[["__scopeId","data-v-42b3b6f3"]]);export{ie as default};
