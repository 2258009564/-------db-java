import{s as p}from"./request-K4Qd0wzI.js";import{_ as D,h as M,f as i,g as L,e as g,o as u,w as a,r as s,b as o,c as y,m as P,F as k,l as V,t as h,d as w,a as x,E as T}from"./index-K2HnPW1F.js";const j={class:"card-header"},z={key:0,class:"stock-info"},A={__name:"StockIn",setup(G){const t=M({fruitId:"",quantity:1,supplierId:""}),m=i(null),d=i([]),f=i([]),n=i(null),_=i(!1),q=async()=>{try{const[r,e]=await Promise.all([p.get("/fruits"),p.get("/suppliers")]);d.value=r,f.value=e}catch(r){console.error(r)}},B=r=>{n.value=d.value.find(e=>e.id===r),n.value&&(t.supplierId=n.value.supplierId)},C=r=>{const e=f.value.find(v=>v.id===r);return e?e.name:"无"},F=async()=>{m.value&&await m.value.validate(async r=>{if(r){_.value=!0;try{await p.post("/stock-in",t),T.success("入库成功"),t.fruitId="",t.quantity=1,t.supplierId="",n.value=null;const e=await p.get("/fruits");d.value=e}catch(e){console.error(e)}finally{_.value=!1}}})};return L(()=>{q()}),(r,e)=>{const v=s("Box"),N=s("el-icon"),b=s("el-option"),I=s("el-select"),c=s("el-form-item"),R=s("el-input-number"),S=s("el-button"),E=s("el-form"),U=s("el-card");return u(),g(U,{class:"box-card",style:{"max-width":"800px",margin:"0 auto"}},{header:a(()=>[x("div",j,[x("span",null,[o(N,null,{default:a(()=>[o(v)]),_:1}),e[3]||(e[3]=w(" 商品入库",-1))])])]),default:a(()=>[o(E,{model:t,"label-width":"100px",ref_key:"formRef",ref:m},{default:a(()=>[o(c,{label:"选择商品",prop:"fruitId",rules:[{required:!0,message:"请选择商品",trigger:"change"}]},{default:a(()=>[o(I,{modelValue:t.fruitId,"onUpdate:modelValue":e[0]||(e[0]=l=>t.fruitId=l),placeholder:"请选择商品",filterable:"",onChange:B,style:{width:"100%"}},{default:a(()=>[(u(!0),y(k,null,V(d.value,l=>(u(),g(b,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n.value?(u(),y("div",z," 当前库存: "+h(n.value.stock)+" | 建议供应商: "+h(C(n.value.supplierId)),1)):P("",!0)]),_:1}),o(c,{label:"入库数量",prop:"quantity",rules:[{required:!0,message:"请输入数量",trigger:"blur"}]},{default:a(()=>[o(R,{modelValue:t.quantity,"onUpdate:modelValue":e[1]||(e[1]=l=>t.quantity=l),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(c,{label:"供应商",prop:"supplierId",rules:[{required:!0,message:"请选择供应商",trigger:"change"}]},{default:a(()=>[o(I,{modelValue:t.supplierId,"onUpdate:modelValue":e[2]||(e[2]=l=>t.supplierId=l),placeholder:"请选择供应商",filterable:"",style:{width:"100%"}},{default:a(()=>[(u(!0),y(k,null,V(f.value,l=>(u(),g(b,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(c,null,{default:a(()=>[o(S,{type:"primary",onClick:F,loading:_.value},{default:a(()=>[...e[4]||(e[4]=[w("确认入库",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})}}},K=D(A,[["__scopeId","data-v-fab4b1cb"]]);export{K as default};
