import{s as y}from"./request-CNVwpvnB.js";import{_ as G,h as J,f as m,g as K,c as b,o as i,b as t,w as a,r as s,m as O,F as C,l as D,e as N,d as u,a as p,t as _,n as Q,E as B}from"./index-DLVwaf9B.js";const W={class:"sales-container"},X={class:"card-header"},Y={key:0,class:"sale-info"},Z={class:"price"},ee={class:"card-header"},le={class:"price"},te={__name:"Sales",setup(ae){const n=J({fruitId:"",customerId:"",employeeId:"",quantity:1}),I=m(null),w=m([]),V=m([]),k=m([]),x=m([]),d=m(null),q=m(!1),F=async()=>{try{const[o,e,r,h]=await Promise.all([y.get("/fruits"),y.get("/customers"),y.get("/employees"),y.get("/sales")]);w.value=o,V.value=e,k.value=r,x.value=h.sort((f,v)=>new Date(v.saleDate)-new Date(f.saleDate))}catch(o){console.error(o)}},E=o=>{d.value=w.value.find(e=>e.id===o)},L=o=>{var e;return((e=w.value.find(r=>r.id===o))==null?void 0:e.name)||o},U=o=>{var e;return((e=V.value.find(r=>r.id===o))==null?void 0:e.name)||o},M=o=>{var e;return((e=k.value.find(r=>r.id===o))==null?void 0:e.name)||o},P=async()=>{I.value&&await I.value.validate(async o=>{if(o){if(d.value&&n.quantity>d.value.stock){B.error(`库存不足，当前仅剩 ${d.value.stock}`);return}q.value=!0;try{await y.post("/sales",n),B.success("销售录入成功"),n.quantity=1,F()}catch(e){console.error(e)}finally{q.value=!1}}})};return K(()=>{F()}),(o,e)=>{const r=s("ShoppingCart"),h=s("el-icon"),f=s("el-option"),v=s("el-select"),g=s("el-form-item"),z=s("el-input-number"),H=s("el-button"),T=s("el-form"),R=s("el-card"),S=s("el-col"),$=s("List"),c=s("el-table-column"),j=s("el-table"),A=s("el-row");return i(),b("div",W,[t(A,{gutter:20},{default:a(()=>[t(S,{span:8},{default:a(()=>[t(R,null,{header:a(()=>[p("div",X,[p("span",null,[t(h,null,{default:a(()=>[t(r)]),_:1}),e[4]||(e[4]=u(" 新销售单",-1))])])]),default:a(()=>[t(T,{model:n,"label-width":"80px",ref_key:"formRef",ref:I},{default:a(()=>[t(g,{label:"商品",prop:"fruitId",rules:[{required:!0,message:"请选择商品",trigger:"change"}]},{default:a(()=>[t(v,{modelValue:n.fruitId,"onUpdate:modelValue":e[0]||(e[0]=l=>n.fruitId=l),placeholder:"请选择",filterable:"",onChange:E,style:{width:"100%"}},{default:a(()=>[(i(!0),b(C,null,D(w.value,l=>(i(),N(f,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),d.value?(i(),b("div",Y,[e[5]||(e[5]=u(" 单价: ",-1)),p("span",Z,"¥"+_(d.value.price),1),e[6]||(e[6]=u(" | 库存: ",-1)),p("span",{class:Q({"low-stock":d.value.stock<10})},_(d.value.stock),3)])):O("",!0)]),_:1}),t(g,{label:"客户",prop:"customerId",rules:[{required:!0,message:"请选择客户",trigger:"change"}]},{default:a(()=>[t(v,{modelValue:n.customerId,"onUpdate:modelValue":e[1]||(e[1]=l=>n.customerId=l),placeholder:"请选择",filterable:"",style:{width:"100%"}},{default:a(()=>[(i(!0),b(C,null,D(V.value,l=>(i(),N(f,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"销售员",prop:"employeeId",rules:[{required:!0,message:"请选择销售员",trigger:"change"}]},{default:a(()=>[t(v,{modelValue:n.employeeId,"onUpdate:modelValue":e[2]||(e[2]=l=>n.employeeId=l),placeholder:"请选择",filterable:"",style:{width:"100%"}},{default:a(()=>[(i(!0),b(C,null,D(k.value,l=>(i(),N(f,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"数量",prop:"quantity",rules:[{required:!0,message:"请输入数量",trigger:"blur"}]},{default:a(()=>[t(z,{modelValue:n.quantity,"onUpdate:modelValue":e[3]||(e[3]=l=>n.quantity=l),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(g,null,{default:a(()=>[t(H,{type:"primary",onClick:P,loading:q.value,style:{width:"100%"}},{default:a(()=>[...e[7]||(e[7]=[u("提交订单",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),t(S,{span:16},{default:a(()=>[t(R,null,{header:a(()=>[p("div",ee,[p("span",null,[t(h,null,{default:a(()=>[t($)]),_:1}),e[8]||(e[8]=u(" 销售记录",-1))])])]),default:a(()=>[t(j,{data:x.value,stripe:"",height:"500"},{default:a(()=>[t(c,{prop:"id",label:"ID",width:"60"}),t(c,{label:"商品",width:"120"},{default:a(l=>[u(_(L(l.row.fruitId)),1)]),_:1}),t(c,{label:"客户",width:"100"},{default:a(l=>[u(_(U(l.row.customerId)),1)]),_:1}),t(c,{label:"员工",width:"100"},{default:a(l=>[u(_(M(l.row.employeeId)),1)]),_:1}),t(c,{prop:"quantity",label:"数量",width:"80"}),t(c,{label:"总价",width:"100"},{default:a(l=>[p("span",le,"¥"+_(l.row.totalPrice),1)]),_:1}),t(c,{label:"时间",width:"180"},{default:a(l=>[u(_(new Date(l.row.saleDate).toLocaleString()),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})])}}},ne=G(te,[["__scopeId","data-v-60d851f9"]]);export{ne as default};
