import{_ as O,f as y,h as Q,g as W,c as b,o as r,b as a,w as l,a as h,i as X,r as n,j as Y,d as V,k as Z,e as c,F as D,l as x,t as ee,E as $,m as le}from"./index-DLVwaf9B.js";import{s as g}from"./request-CNVwpvnB.js";const te={class:"base-table-container"},ae={class:"card-header"},oe={class:"toolbar"},ne={class:"dialog-footer"},re={__name:"BaseTable",props:{title:String,entity:String,columns:Array,formItems:Array,searchPlaceholder:String,searchParam:{type:String,default:"name"}},setup(d,{expose:P}){const p=d,w=y([]),m=y(!1),v=y(""),_=y(!1),u=Q({}),k=y(null),i=async()=>{m.value=!0;try{const o=await g.get(`/${p.entity}`);w.value=o}catch(o){console.error(o)}finally{m.value=!1}},S=async()=>{if(!v.value){i();return}m.value=!0;try{const o=await g.get(`/${p.entity}/search`,{params:{[p.searchParam]:v.value}});w.value=o}catch(o){console.error(o)}finally{m.value=!1}},E=()=>{p.formItems.forEach(o=>{u[o.prop]=o.defaultValue!==void 0?o.defaultValue:""}),_.value=!0},I=async()=>{k.value&&await k.value.validate(async o=>{if(o)try{await g.post(`/${p.entity}`,u),$.success("保存成功"),_.value=!1,i()}catch(t){console.error(t)}})},N=async o=>{try{await g.delete(`/${p.entity}/${o.id}`),$.success("删除成功"),i()}catch(t){console.error(t)}};return W(()=>{i()}),P({fetchData:i}),(o,t)=>{const A=n("Plus"),C=n("el-icon"),f=n("el-button"),K=n("Search"),U=n("el-input"),B=n("el-table-column"),T=n("Delete"),F=n("el-popconfirm"),M=n("el-table"),R=n("el-card"),j=n("el-input-number"),q=n("el-option"),z=n("el-select"),L=n("el-form-item"),G=n("el-form"),H=n("el-dialog"),J=Z("loading");return r(),b("div",te,[a(R,null,{header:l(()=>[h("div",ae,[h("span",null,ee(d.title),1),a(f,{type:"primary",onClick:E},{default:l(()=>[a(C,null,{default:l(()=>[a(A)]),_:1}),t[3]||(t[3]=V(" 新增 ",-1))]),_:1})])]),default:l(()=>[h("div",oe,[a(U,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),placeholder:d.searchPlaceholder,class:"search-input",clearable:"",onClear:i,onKeyup:Y(S,["enter"])},{append:l(()=>[a(f,{onClick:S},{default:l(()=>[a(C,null,{default:l(()=>[a(K)]),_:1}),t[4]||(t[4]=V(" 查询 ",-1))]),_:1})]),_:1},8,["modelValue","placeholder"])]),X((r(),c(M,{data:w.value,stripe:"",style:{width:"100%"}},{default:l(()=>[(r(!0),b(D,null,x(d.columns,e=>(r(),c(B,{key:e.prop,prop:e.prop,label:e.label,width:e.width,formatter:e.formatter},null,8,["prop","label","width","formatter"]))),128)),a(B,{label:"操作",width:"150"},{default:l(e=>[a(F,{title:"确定删除吗？",onConfirm:s=>N(e.row)},{reference:l(()=>[a(f,{type:"danger",size:"small",circle:""},{default:l(()=>[a(C,null,{default:l(()=>[a(T)]),_:1})]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[J,m.value]])]),_:1}),a(H,{modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=e=>_.value=e),title:"新增"+d.title,width:"500px"},{footer:l(()=>[h("span",ne,[a(f,{onClick:t[1]||(t[1]=e=>_.value=!1)},{default:l(()=>[...t[5]||(t[5]=[V("取消",-1)])]),_:1}),a(f,{type:"primary",onClick:I},{default:l(()=>[...t[6]||(t[6]=[V("保存",-1)])]),_:1})])]),default:l(()=>[a(G,{model:u,"label-width":"80px",ref_key:"formRef",ref:k},{default:l(()=>[(r(!0),b(D,null,x(d.formItems,e=>(r(),c(L,{key:e.prop,label:e.label,prop:e.prop,rules:[{required:!0,message:"请输入"+e.label,trigger:"blur"}]},{default:l(()=>[e.type==="text"?(r(),c(U,{key:0,modelValue:u[e.prop],"onUpdate:modelValue":s=>u[e.prop]=s},null,8,["modelValue","onUpdate:modelValue"])):e.type==="number"?(r(),c(j,{key:1,modelValue:u[e.prop],"onUpdate:modelValue":s=>u[e.prop]=s,step:e.step||1,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue","step"])):e.type==="select"?(r(),c(z,{key:2,modelValue:u[e.prop],"onUpdate:modelValue":s=>u[e.prop]=s,placeholder:"请选择",style:{width:"100%"}},{default:l(()=>[(r(!0),b(D,null,x(e.options,s=>(r(),c(q,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):le("",!0)]),_:2},1032,["label","prop","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ce=O(re,[["__scopeId","data-v-920045cc"]]);export{ce as B};
