import{s as c}from"./request-BRaJE9vJ.js";import{_ as O,r,o as Q,b as g,e as t,f as a,g as d,q as W,j as m,k as y,x as X,m as i,p as b,l as p,F as x,y as E,E as Y,A as N}from"./index-C_fYYLRm.js";const Z={class:"sales-view"},ee={class:"table-header"},le={style:{color:"#67c23a","font-weight":"bold"}},te={class:"dialog-footer"},ae={__name:"Sales",setup(oe){const w=r(!1),R=r([]),V=r([]),k=r([]),I=r([]),f=r(!1),s=r({}),D=r(null),v=r(!1),B=r([]),C=async()=>{w.value=!0;try{const[o,e,u,n]=await Promise.all([c.get("/sales"),c.get("/fruits"),c.get("/employees"),c.get("/customers")]);R.value=o,V.value=e,k.value=u,I.value=n,B.value=R.value}catch(o){console.error(o)}finally{w.value=!1}},U=o=>{const e=V.value.find(u=>u.id===o);return e?e.name:o},F=o=>{const e=k.value.find(u=>u.id===o);return e?e.name:o},$=o=>{const e=I.value.find(u=>u.id===o);return e?e.name:o},M=o=>o?new Date(o).toLocaleString():"",P=()=>{v.value=!1,s.value={},f.value=!0},S=o=>{v.value=!0,s.value={...o},f.value=!0},z=async o=>{try{await Y.confirm("确定要删除这条销售记录吗？","提示",{type:"warning"}),await c.delete(`/sales/${o.id}`),N.success("删除成功"),C()}catch{}},A=async()=>{D.value&&await D.value.validate(async o=>{o&&(v.value?(await c.put("/sales",s.value),N.success("更新成功")):(await c.post("/sales",s.value),N.success("销售成功")),f.value=!1,C())})};return Q(()=>{C()}),(o,e)=>{const u=d("el-button"),n=d("el-table-column"),L=d("el-table"),j=d("el-card"),h=d("el-option"),q=d("el-select"),_=d("el-form-item"),T=d("el-input-number"),G=d("el-form"),H=d("el-dialog"),J=W("loading");return m(),g("div",Z,[t(j,{shadow:"never",class:"glass-panel"},{default:a(()=>[y("div",ee,[e[7]||(e[7]=y("h3",null,"销售记录",-1)),t(u,{type:"primary",icon:"Plus",onClick:P},{default:a(()=>[...e[6]||(e[6]=[i("新增销售",-1)])]),_:1})]),X((m(),b(L,{data:B.value,style:{width:"100%"},class:"custom-table"},{default:a(()=>[t(n,{prop:"id",label:"ID",width:"80"}),t(n,{label:"水果"},{default:a(l=>[i(p(U(l.row.fruitId)),1)]),_:1}),t(n,{label:"销售员"},{default:a(l=>[i(p(F(l.row.employeeId)),1)]),_:1}),t(n,{label:"客户"},{default:a(l=>[i(p($(l.row.customerId)),1)]),_:1}),t(n,{prop:"quantity",label:"数量"}),t(n,{label:"总价"},{default:a(l=>[y("span",le,"¥"+p(l.row.totalPrice),1)]),_:1}),t(n,{label:"日期"},{default:a(l=>[i(p(M(l.row.saleDate)),1)]),_:1}),t(n,{label:"操作",width:"180",align:"right"},{default:a(l=>[t(u,{size:"small",onClick:K=>S(l.row)},{default:a(()=>[...e[8]||(e[8]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(u,{size:"small",type:"danger",onClick:K=>z(l.row)},{default:a(()=>[...e[9]||(e[9]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,w.value]])]),_:1}),t(H,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=l=>f.value=l),title:v.value?"编辑销售":"新增销售",width:"500px"},{footer:a(()=>[y("span",te,[t(u,{onClick:e[4]||(e[4]=l=>f.value=!1)},{default:a(()=>[...e[10]||(e[10]=[i("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:A},{default:a(()=>[...e[11]||(e[11]=[i("确定",-1)])]),_:1})])]),default:a(()=>[t(G,{ref_key:"formRef",ref:D,model:s.value,"label-width":"80px"},{default:a(()=>[t(_,{label:"水果",prop:"fruitId",rules:[{required:!0,message:"请选择水果",trigger:"change"}]},{default:a(()=>[t(q,{modelValue:s.value.fruitId,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.fruitId=l),placeholder:"请选择水果",style:{width:"100%"}},{default:a(()=>[(m(!0),g(x,null,E(V.value,l=>(m(),b(h,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"销售员",prop:"employeeId",rules:[{required:!0,message:"请选择销售员",trigger:"change"}]},{default:a(()=>[t(q,{modelValue:s.value.employeeId,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.employeeId=l),placeholder:"请选择销售员",style:{width:"100%"}},{default:a(()=>[(m(!0),g(x,null,E(k.value,l=>(m(),b(h,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"客户",prop:"customerId",rules:[{required:!0,message:"请选择客户",trigger:"change"}]},{default:a(()=>[t(q,{modelValue:s.value.customerId,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.customerId=l),placeholder:"请选择客户",style:{width:"100%"}},{default:a(()=>[(m(!0),g(x,null,E(I.value,l=>(m(),b(h,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"数量",prop:"quantity",rules:[{required:!0,message:"请输入数量",trigger:"blur"}]},{default:a(()=>[t(T,{modelValue:s.value.quantity,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.quantity=l),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ne=O(ae,[["__scopeId","data-v-17a58d14"]]);export{ne as default};
