import{s as p}from"./request-D0wjgGDw.js";import{_ as z,r as d,o as G,b as v,e as t,f as a,g as n,q as H,j as i,k as g,x as J,m,p as b,l as f,F as h,y as x,A as K}from"./index-_FXwDFUA.js";const O={class:"sales-view"},Q={class:"table-header"},W={style:{color:"#67C23A","font-weight":"bold"}},X={class:"dialog-footer"},Y={__name:"Sales",setup(Z){const y=d(!1),C=d([]),w=d([]),V=d([]),I=d([]),c=d(!1),s=d({}),k=d(null),N=d([]),R=async()=>{y.value=!0;try{const[o,l,u,r]=await Promise.all([p.get("/sales"),p.get("/fruits"),p.get("/employees"),p.get("/customers")]);C.value=o,w.value=l,V.value=u,I.value=r,N.value=C.value}catch(o){console.error(o)}finally{y.value=!1}},U=o=>{const l=w.value.find(u=>u.id===o);return l?l.name:o},B=o=>{const l=V.value.find(u=>u.id===o);return l?l.name:o},F=o=>{const l=I.value.find(u=>u.id===o);return l?l.name:o},A=o=>o?new Date(o).toLocaleString():"",E=()=>{s.value={},c.value=!0},P=async()=>{k.value&&await k.value.validate(async o=>{o&&(await p.post("/sales",s.value),K.success("销售成功"),c.value=!1,R())})};return G(()=>{R()}),(o,l)=>{const u=n("el-button"),r=n("el-table-column"),S=n("el-table"),L=n("el-card"),D=n("el-option"),q=n("el-select"),_=n("el-form-item"),M=n("el-input-number"),j=n("el-form"),T=n("el-dialog"),$=H("loading");return i(),v("div",O,[t(L,{shadow:"never"},{default:a(()=>[g("div",Q,[l[7]||(l[7]=g("h3",null,"销售记录",-1)),t(u,{type:"primary",icon:"Plus",onClick:E},{default:a(()=>[...l[6]||(l[6]=[m("新增销售",-1)])]),_:1})]),J((i(),b(S,{data:N.value,stripe:"",style:{width:"100%"}},{default:a(()=>[t(r,{prop:"id",label:"ID",width:"80"}),t(r,{label:"水果"},{default:a(e=>[m(f(U(e.row.fruitId)),1)]),_:1}),t(r,{label:"销售员"},{default:a(e=>[m(f(B(e.row.employeeId)),1)]),_:1}),t(r,{label:"客户"},{default:a(e=>[m(f(F(e.row.customerId)),1)]),_:1}),t(r,{prop:"quantity",label:"数量"}),t(r,{label:"总价"},{default:a(e=>[g("span",W,"¥"+f(e.row.totalPrice),1)]),_:1}),t(r,{label:"日期"},{default:a(e=>[m(f(A(e.row.saleDate)),1)]),_:1})]),_:1},8,["data"])),[[$,y.value]])]),_:1}),t(T,{modelValue:c.value,"onUpdate:modelValue":l[5]||(l[5]=e=>c.value=e),title:"新增销售",width:"500px"},{footer:a(()=>[g("span",X,[t(u,{onClick:l[4]||(l[4]=e=>c.value=!1)},{default:a(()=>[...l[8]||(l[8]=[m("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:P},{default:a(()=>[...l[9]||(l[9]=[m("确定",-1)])]),_:1})])]),default:a(()=>[t(j,{ref_key:"formRef",ref:k,model:s.value,"label-width":"80px"},{default:a(()=>[t(_,{label:"水果",prop:"fruitId",rules:[{required:!0,message:"请选择水果",trigger:"change"}]},{default:a(()=>[t(q,{modelValue:s.value.fruitId,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value.fruitId=e),placeholder:"请选择水果",style:{width:"100%"}},{default:a(()=>[(i(!0),v(h,null,x(w.value,e=>(i(),b(D,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"销售员",prop:"employeeId",rules:[{required:!0,message:"请选择销售员",trigger:"change"}]},{default:a(()=>[t(q,{modelValue:s.value.employeeId,"onUpdate:modelValue":l[1]||(l[1]=e=>s.value.employeeId=e),placeholder:"请选择销售员",style:{width:"100%"}},{default:a(()=>[(i(!0),v(h,null,x(V.value,e=>(i(),b(D,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"客户",prop:"customerId",rules:[{required:!0,message:"请选择客户",trigger:"change"}]},{default:a(()=>[t(q,{modelValue:s.value.customerId,"onUpdate:modelValue":l[2]||(l[2]=e=>s.value.customerId=e),placeholder:"请选择客户",style:{width:"100%"}},{default:a(()=>[(i(!0),v(h,null,x(I.value,e=>(i(),b(D,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"数量",prop:"quantity",rules:[{required:!0,message:"请输入数量",trigger:"blur"}]},{default:a(()=>[t(M,{modelValue:s.value.quantity,"onUpdate:modelValue":l[3]||(l[3]=e=>s.value.quantity=e),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},te=z(Y,[["__scopeId","data-v-4cdea020"]]);export{te as default};
