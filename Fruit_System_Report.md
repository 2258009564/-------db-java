# 《DB-Java》课程设计报告

**题 目**：水果销售管理系统  
**班 级**：[您的班级]  
**专 业**：软件工程  
**姓 名**：[您的姓名]  
**学 号**：[您的学号]  
**指导教师**：[教师姓名]  
**日 期**：2025 年 12 月 24 日

---

## 目录

1. [一、需求分析](#一需求分析)
2. [二、系统设计](#二系统设计)
3. [三、系统编码及运行](#三系统编码及运行)
4. [四、系统测试](#四系统测试)
5. [五、总结](#五总结)

---

## 一、需求分析

### 1.1 背景

随着人们生活水平的提高，水果消费需求日益增长，传统的水果店管理模式（如手工记账、人工盘点）已难以满足高效经营的需求。手工记录容易出错，库存管理混乱，销售统计繁琐，严重影响了店铺的运营效率和利润分析。为了解决这些问题，开发一套数字化、自动化的水果销售管理系统显得尤为重要。

### 1.2 系统概述

本系统旨在为水果店提供一套全方位的管理解决方案。系统基于 B/S 架构（浏览器/服务器模式），用户无需安装客户端，通过浏览器即可访问。

- **前端**：采用 HTML5、Bootstrap 5 构建响应式界面，使用 jQuery 进行 DOM 操作和 AJAX 数据交互，SweetAlert2 提供友好的交互提示。
- **后端**：基于 Java 语言，使用 Spring Boot 框架快速构建 RESTful API，利用 Spring Data JPA 简化数据库操作。
- **数据库**：使用 MySQL 8.0 存储客户、员工、供应商、商品及销售数据。

### 1.3 主要功能

1.  **基础数据管理**：
    - **客户管理**：录入和维护客户信息（姓名、电话、地址），方便后续进行会员营销。
    - **员工管理**：管理店铺员工的基本信息和职位。
    - **供应商管理**：维护供货商渠道信息，确保货源可追溯。
    - **商品管理**：管理水果的名称、价格、所属供应商，并实时监控库存状态。
2.  **业务流程管理**：
    - **入库管理**：记录水果进货信息，系统自动增加对应商品的库存数量。
    - **销售管理**：处理日常销售业务，选择客户、员工和商品，系统自动计算总价并扣减库存。
3.  **统计分析**：
    - **销售统计**：按商品维度统计总销量和总销售额，为进货决策提供数据支持。

---

## 二、系统设计

### 2.1 系统中的数据定义 (数据库设计)

本系统使用 MySQL 数据库 `fruit_db`，包含以下核心数据表：

#### 1. 客户表 (customer)

存储购买水果的客户信息。
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 客户 ID |
| name | VARCHAR(100) | NOT NULL | 客户姓名 |
| phone | VARCHAR(20) | | 联系电话 |
| address | VARCHAR(255) | | 联系地址 |

#### 2. 员工表 (employee)

存储店铺员工信息。
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 员工 ID |
| name | VARCHAR(100) | NOT NULL | 员工姓名 |
| phone | VARCHAR(20) | | 联系电话 |
| position | VARCHAR(100) | | 职位 |

#### 3. 供应商表 (supplier)

存储水果供货商信息。
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 供应商 ID |
| name | VARCHAR(100) | NOT NULL | 供应商名称 |
| phone | VARCHAR(20) | | 联系电话 |
| address | VARCHAR(255) | | 地址 |

#### 4. 水果商品表 (fruit)

存储水果的基本信息及当前库存。
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 商品 ID |
| name | VARCHAR(100) | NOT NULL | 水果名称 |
| price | DECIMAL(10, 2) | NOT NULL | 销售单价 |
| stock | INT | DEFAULT 0 | 当前库存量 |
| supplier_id | BIGINT | FOREIGN KEY | 关联供应商 ID |

#### 5. 入库记录表 (stock_in)

记录每次进货的详细信息。
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 记录 ID |
| fruit_id | BIGINT | FOREIGN KEY | 关联商品 ID |
| quantity | INT | NOT NULL | 入库数量 |
| stock_in_date | DATETIME | DEFAULT CURRENT_TIMESTAMP | 入库时间 |
| supplier_id | BIGINT | FOREIGN KEY | 关联供应商 ID |

#### 6. 销售记录表 (sales)

记录每一笔销售交易。
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 销售 ID |
| fruit_id | BIGINT | FOREIGN KEY | 关联商品 ID |
| customer_id | BIGINT | FOREIGN KEY | 关联客户 ID |
| employee_id | BIGINT | FOREIGN KEY | 关联员工 ID |
| quantity | INT | NOT NULL | 销售数量 |
| total_price | DECIMAL(10, 2) | | 本单总价 |
| sale_date | DATETIME | DEFAULT CURRENT_TIMESTAMP | 销售时间 |

### 2.2 系统的概要设计

系统采用经典的分层架构：

1.  **表现层 (Controller)**: `FruitController` 负责接收前端 AJAX 请求，处理参数，并返回 JSON 格式的数据。
2.  **业务逻辑层 (Service)**: `FruitService` 封装具体的业务逻辑，如销售时的库存检查、价格计算、事务管理。
3.  **数据访问层 (Repository)**: 使用 Spring Data JPA 接口 (`FruitRepository`, `SalesRepository` 等) 直接与 MySQL 数据库交互，无需编写复杂的 SQL 语句。
4.  **实体层 (Entity)**: 定义与数据库表一一对应的 Java 类 (`Fruit`, `Sales` 等)。

### 2.3 系统的核心算法与逻辑

1.  **销售逻辑 (Sale Process)**:

    - 接收销售请求（商品 ID, 数量, 客户 ID, 员工 ID）。
    - 查询商品当前库存。
    - **判断**: 若 `请求数量 > 当前库存`，抛出异常，提示“库存不足”。
    - **计算**: `总价 = 商品单价 * 销售数量`。
    - **更新**: 扣减商品表中的库存 (`stock = stock - quantity`)。
    - **记录**: 在销售表中插入一条新记录。
    - 以上步骤在同一个事务 (`@Transactional`) 中执行，确保数据一致性。

2.  **入库逻辑 (Stock In Process)**:
    - 接收入库请求。
    - 在入库记录表中添加记录。
    - 更新商品表库存 (`stock = stock + quantity`)。

---

## 三、系统编码及运行

### 3.1 系统开发涉及的软件与技术栈

- **操作系统**: Windows
- **开发工具 (IDE)**: Visual Studio Code (VS Code)
- **构建工具**: Maven
- **后端技术**:
  - **语言**: Java 17 / 21
  - **框架**: Spring Boot 2.7.5
  - **ORM**: Spring Data JPA
- **前端技术**:
  - **结构**: HTML5
  - **样式**: Bootstrap 5 (CSS Framework)
  - **脚本**: JavaScript (ES6), jQuery
  - **交互**: SweetAlert2 (弹窗组件)
- **数据库**: MySQL 8.0
- **接口测试**: Postman / 浏览器开发者工具

### 3.2 系统运行界面

系统采用单页应用 (SPA) 风格的设计，左侧为导航菜单，右侧为内容区域。

1.  **首页**: 显示欢迎信息和系统概览。
2.  **商品管理页**: 表格展示所有水果，支持“添加商品”模态框，可进行删除操作。
3.  **销售管理页**:
    - 左侧：销售开单区域，下拉选择商品（显示实时库存和价格）、客户、员工，输入数量。
    - 右侧：实时销售记录列表。
4.  **统计页**: 图表或表格形式展示各商品的销售业绩。

---

## 四、系统测试

### 4.1 测试环境

- **硬件**: PC 机 (Intel Core i5, 16GB RAM)
- **软件**: Windows 11, Chrome 浏览器, MySQL 8.0

### 4.2 测试用例与结果

1.  **库存不足测试**:
    - **操作**: 选择库存为 10 的“红富士苹果”，输入销售数量 20，点击提交。
    - **预期**: 系统弹出错误提示“库存不足”，数据库不发生变化。
    - **结果**: 界面显示 SweetAlert 错误弹窗，测试通过。
2.  **正常销售测试**:
    - **操作**: 选择库存为 10 的“香蕉”，输入销售数量 5。
    - **预期**: 提示“销售成功”，库存变为 5，销售记录表中增加一条记录。
    - **结果**: 操作成功，数据更新正确，测试通过。
3.  **数据关联测试**:
    - **操作**: 删除一个已有销售记录的商品。
    - **预期**: 由于外键约束，数据库应阻止删除，或级联处理（视配置而定，本系统配置为保护数据，提示无法删除）。
    - **结果**: 后端捕获外键异常，前端提示“该商品存在关联数据，无法删除”，测试通过。

### 4.3 遇到的问题及解决方案

- **问题**: 数据库中文乱码。
  - **解决**: 在 `application.properties` 连接字符串中添加 `characterEncoding=utf-8`，并将数据库字符集设置为 `utf8mb4`。
- **问题**: 前端页面切换时数据未刷新。
  - **解决**: 在 `loadPage` 函数中添加回调，每次切换页面时重新调用 `loadData()` 获取最新数据。
- **问题**: 跨域请求被拦截 (CORS)。
  - **解决**: 在 Spring Boot 控制器类上添加 `@CrossOrigin(origins = "*")` 注解。

---

## 五、总结

本项目成功开发了一套基于 Spring Boot 和 MySQL 的水果销售管理系统。

- **技术层面**: 摒弃了传统的 Java Swing 桌面开发模式，采用了更符合现代潮流的 B/S 架构。后端利用 Spring Boot 的自动配置极大简化了开发流程，前端使用 Bootstrap 实现了美观的响应式界面。
- **功能层面**: 实现了从进货到销售的完整闭环，数据结构设计合理，能够满足小型水果店的日常经营需求。
- **收获**: 深入理解了 RESTful API 的设计原则，掌握了前后端分离开发的基本模式，以及 JPA 在处理复杂数据库关系时的优势。

未来可以进一步扩展功能，如增加会员积分系统、引入 ECharts 图表进行可视化数据分析、以及部署到云服务器实现远程访问。
